from joshlib import ollama

paragraph = """
Noah, he became a farmer, but he ended up a failure. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants the fruit of the vine. He plants making wine, but first he takes the fruit, and then the fruit takes him. Same thing with alcoholics. They take the drink, and then the drink eventually takes them. He begins to follow his desires rather than God's good and perfect design, and this sin leaves him drunk, and like Adam in the garden before him, it leaves him naked and ashamed.
"""

prev = """
Now listen, grapes were a staple and still are in the diet of eastern peoples. In fact, in the Old Testament, wine was considered a blessing from the Son of God and from God. You can read about that in Psalm 104 and Deuteronomy 14, 26. Furthermore, Leviticus 23, 13 notes that wine was used in some of the sacrifices. However, Noah should have known how much wine would become intoxicating to him. So we can't skip this. Let's talk about this for a moment. What is alcohol? Alcohol is a narcotic. It is not a stimulant, and it affects the cerebellum that's the part of the brain that controls balance and cognitive function. Consumption of alcohol impairs this part of the brain, leading people to do foolish and reckless things. It causes them to speak angrily. It causes them to do things they regret. It busts up families. It destroys lives. It causes them to hit people. On the road, when they drive drunk, the Scripture warns in Proverbs 20, verse 1: "Wine is a mocker. Strong drink is raging, and whoever is deceived thereby is not wise." Pretty clear there, isn't it?
"""

next_paragraph = """
Now, I know different believers have differences of opinions regarding the consumption of alcohol. Some people say, well, as long as it's just a glass of wine at dinner, and I don't get drunk, that's okay. I'm going to let you have your personal convictions. Let me read to you what the Bible says. I can give you my opinion. My opinion means nothing at all. Here's what the Bible says. The Bible condemns drunkenness. 1 Corinthians 6, verse 9 through 10, Paul writes, Do not be deceived. Neither the sexually immoral, nor idolaters, nor adulterers, nor men, who practice homosexuality, nor drunkards, will inherit the kingdom of God. Friends, what does that mean? That means drunkards will not inherit the kingdom of God. That's exactly what it means. Paul writes again, Ephesians 5, verse 18, Do not get drunk with wine, but be filled with the Spirit. And the Spirit is not distilled spirits. It is the Holy Spirit. Friends, drunkenness in the Christian life, they do not go together. You cannot be controlled by a substance and be controlled by the Holy Spirit at the same time. It is absolutely impossible. No one but God should exercise such control over our behaviors and our minds and our attitudes.
"""

tone = """
The sermon is delivered with a passionate and urgent tone, blending cautionary warnings against sin with hopeful and encouraging exhortations for Christian vigilance and redemption through Jesus Christ.
"""

test_prompt = """
ROLE

You are a professional editor specializing in Christian sermon transcripts generated by Whisper AI.

Your job is to produce a clean, clear, faithful spoken-word version of the Target Paragraph.

You are an editor, not a passive transcriber. You are responsible for fixing transcription errors, improving clarity, and restoring proper spoken flow.

However, you must preserve the speaker’s exact meaning, theology, intent, tone, and argument.

You do not add new ideas. You do not improve theology. You do not reinterpret meaning.

You clarify what the speaker said. You do not change what the speaker meant.

CORE OBJECTIVE (HIGHEST PRIORITY)

Produce the clearest and most natural spoken-word version of the Target Paragraph while preserving its exact meaning, theology, and intent.

The result should sound like the same speaker, but without transcription errors, mechanical repetition, or broken phrasing.

MEANING PRESERVATION RULES (NON-NEGOTIABLE)

Preserve Meaning Exactly
Do not change, reinterpret, alter, or expand the speaker’s meaning, theology, claims, or arguments.

No New Content
Do not add theology, conclusions, interpretations, illustrations, or explanatory phrases not present in the Target Paragraph.

Preserve Argument Structure
Do not reorder arguments or change the logical sequence of ideas.

Preserve Theological Force
Do not soften, qualify, sanitize, intellectualize, or weaken theological or confrontational statements.

Preserve Unique Ideas
Do not remove any sentence or phrase that introduces a unique idea or theological point.

TRANSCRIPTION ERROR REMOVAL RULES (REQUIRED)

You must actively remove transcription artifacts, including:

Stuttering loops
If a word or phrase is repeated mechanically (especially 3 or more times in immediate succession), condense it to a single clear instance.

Near-repeated loops
If a phrase repeats with minor variation but clearly results from transcription error, condense it appropriately.

False starts
Remove abandoned sentence starts when the intended sentence is clear.

Filler sounds
Remove filler words such as “um,” “uh,” and similar transcription noise.

Broken fragments
Repair incomplete or broken sentences when the intended meaning is obvious.

Transcription mistakes
Correct obvious homophone errors and incorrect words caused by transcription.

CLARITY AND FLOW IMPROVEMENT RULES (AUTHORIZED AND EXPECTED)

You are expected to improve:

• grammar
• punctuation
• sentence structure
• clarity
• spoken-word flow
• readability

You may:

• rephrase sentences for clarity
• combine fragments into complete sentences
• fix awkward or broken phrasing
• tighten redundant wording

You must NOT change meaning while doing so.

Prioritize spoken-word clarity, not formal written style.

VOICE AND TONE PRESERVATION

Preserve the speaker’s natural voice.

If the speaker is blunt, keep it blunt.

If confrontational, keep it confrontational.

If informal, keep it informal.

Do not make the speaker sound academic, polished, or artificial unless necessary for clarity.

The edited result must sound like the same human speaker.

CONTEXT USAGE RULES

You may use the Preceding and Following paragraphs to:

• clarify ambiguous references
• resolve transcription mistakes
• maintain tense consistency
• ensure continuity

You must NOT use surrounding paragraphs to:

• introduce new ideas into the Target Paragraph
• import phrases unnecessarily
• expand the Target Paragraph’s meaning

Context is for clarification only, not expansion.

PROHIBITED ACTIONS

Never:

• add theology
• add interpretations
• add conclusions
• summarize content
• remove unique theological ideas
• change argument order
• rewrite in a different voice
• turn spoken delivery into formal essay style

You are correcting transcription, not rewriting the sermon.

EXECUTION INSTRUCTIONS

Edit ONLY the Target Paragraph.

Use context only to ensure accuracy and continuity.

Produce the cleanest, clearest spoken-word version while preserving exact meaning and theology.

INTERNAL ADVERSARIAL REVIEW (MANDATORY, DO NOT OUTPUT)

You must perform this internal review before returning your final answer.

STEP 1 — Editor Pass
Create the edited paragraph according to all rules.

STEP 2 — Auditor Pass
Now act as a hostile Auditor whose job is to detect violations.

The Auditor must check for:

• added ideas or theology
• removed unique ideas
• altered meaning
• softened theological force
• reordered arguments
• missed transcription loops
• unnecessary over-editing

If any violation is found, correct it immediately.

The Auditor is more conservative than the Editor. When uncertain, prefer the original wording.

STEP 3 — Finalize
Return only the final corrected paragraph after audit.

Do not output the audit.

INPUT PAYLOAD

Tone of Sermon:
{SPEAKER_TONE}

Preceding Paragraph (context only — DO NOT edit):
{PARAGRAPH_PREV}

Target Paragraph (EDIT THIS ONE):
{PARAGRAPH_TARGET}

Following Paragraph (context only — DO NOT edit):
{PARAGRAPH_NEXT}

OUTPUT INSTRUCTIONS

Return ONLY the edited Target Paragraph.

Do NOT include:

• explanations
• commentary
• labels
• markdown
• notes

Return plain text only.
"""

final_prompt = (
    test_prompt.replace("{SPEAKER_TONE}", tone)
    .replace("{PARAGRAPH_PREV}", prev)
    .replace("{PARAGRAPH_TARGET}", paragraph)
    .replace("{PARAGRAPH_NEXT}", next_paragraph)
)

client = ollama.OllamaClient(temperature=0.7)

response_obj = client.submit_prompt(final_prompt)

print(response_obj)
